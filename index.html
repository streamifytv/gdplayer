<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>24/7 Live Sports & Entertainment Channels</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #039be5;
            --secondary-color: #6c757d;
            --dark-bg: #121212;
            --card-bg: #1e1e1e;
            --text-light: #f8f9fa;
        }
        
        body {
            background: linear-gradient(to bottom, #1a1a1a, #0d0d0d);
            color: var(--text-light);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: auto !important;
            padding-bottom: 2rem;
        }
        
        .navbar-brand {
            font-weight: 700;
            letter-spacing: 1px;
            color: #039be5;
            font-size: 20pt;
        }
        
        .hero-section {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        
        .json-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        
        .json-table th,
        .json-table td {
            border: 1px solid #333;
            padding: 12px 15px;
            text-align: left;
            font-size: 0.95rem;
        }
        
        .json-table th {
            background: #2a2a2a;
            font-weight: 600;
            color: #039be5;
        }
        
        .json-table tr:nth-child(even) {
            background-color: rgba(40, 40, 40, 0.6);
        }
        
        .json-table tr:hover {
            background-color: rgba(50, 50, 50, 0.8);
        }
        
        .expand-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            text-align: center;
            margin-right: 8px;
            cursor: pointer;
            color: #039be5;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        .expand-icon.collapsed {
            transform: rotate(0deg);
        }
        
        .expand-icon.expanded {
            transform: rotate(90deg);
        }
        
        .category-row {
            background: rgba(3, 155, 229, 0.15) !important;
            font-weight: 600;
        }
        
        .event-row {
            background: rgba(50, 50, 50, 0.7) !important;
        }
        
        .channel-row {
            background: rgba(30, 30, 30, 0.9) !important;
        }
        
        .status-live {
            background: linear-gradient(135deg, #ff0000, #cc0000);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        .status-upcoming {
            background: linear-gradient(135deg, #ffa500, #cc8400);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-completed {
            background: linear-gradient(135deg, #808080, #606060);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .search-container {
            position: relative;
            max-width: 500px;
            margin: 0 auto 2rem;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #039be5;
        }
        
        .search-input {
            padding-left: 40px;
            border-radius: 50px;
            border: 2px solid transparent;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .search-input:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
            color: white;
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .result-count {
            color: #adb5bd;
            font-size: 0.9rem;
            margin-top: 1rem;
        }
        
        .no-results {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
            background: var(--card-bg);
            border-radius: 8px;
            margin-top: 1.5rem;
        }
        
        .footer {
            background: rgba(0, 0, 0, 0.8);
            padding: 1.5rem 0;
            margin-top: 3rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .marquee-container {
            display: flex;
            height: 50px;
            align-items: center;
            border: 2px solid #29b6f6;
            border-radius: 10px;
            width: 100%;
            box-sizing: border-box;
            background-color: transparent;
        }
        
        .logo-box {
            width: 50px;
            height: 50px;
            border-radius: 10px 0px 0px 10px;
            background: #29b6f6;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #29b6f6;
            margin-right: 15px;
            flex-shrink: 0;
            padding: 0;
            margin: 0;
        }
        
        .logo-box i {
            color: white;
            font-size: 16px;
        }
        
        marquee {
            flex: 1;
            color: #039be5;
            font-size: 18px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 2rem;
            background: var(--card-bg);
            border-radius: 8px;
            margin-top: 1.5rem;
        }
        
        .first-category {
            background: var(--primary-color) !important;
        }
        
        .stream-btn {
            background: linear-gradient(135deg, #3a3a3a, #2a2a2a);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            transition: all 0.3s ease;
            display: inline-block;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.8rem;
            margin: 2px 0;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .stream-btn:hover {
            background: linear-gradient(135deg, #4a4a4a, #3a3a3a);
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .stream-btn i {
            margin-right: 5px;
            font-size: 0.75rem;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 1.5rem;
        }
        
        .error-message {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            color: #ffcccc;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" id="gdp" href="#">GD PLAYER</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-dollar-sign me-1"></i> Buy a Plan</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="//t.me/wasi_tv"><i class="fas fa-envelope me-1"></i> Contact</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-question-circle me-1"></i> FAQs</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fab fa-github me-1"></i> GitHub</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <div class="hero-section text-center">
            <h1 class="display-5 fw-bold mb-3">24/7 Live Sports & Entertainment Channels</h1>
            <p class="lead mb-4">Access your favorite channels anytime, anywhere. Stream live content with no interruptions.</p>
            
            <div class="search-container">
                <i class="search-icon fas fa-search"></i>
                <input type="search" class="form-control search-input" id="search" placeholder="Search channels...">
            </div>
            <p class="result-count" id="resultCount">Loading channels...</p>
        </div>

        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading channels from API...</p>
        </div>

        <div class="table-container">
            <table class="json-table" id="channelTable">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Event</th>
                        <th>Time</th>
                        <th>Status</th>
                        <th>Channels</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Data will be populated here -->
                </tbody>
            </table>
        </div>
        
        <div class="no-results d-none" id="noResults">
            <i class="fas fa-search fa-3x mb-3"></i>
            <h4>No channels found</h4>
            <p>Try different search terms</p>
        </div>
        
        <div class="error-message d-none" id="errorMessage">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Error loading data:</strong> 
            <span id="errorDetails">Failed to load channels from the API.</span>
        </div>
    </div>

    <footer class="footer text-center">
        <div class="container">
            <p class="mb-0">© <script>document.write("2018-"+new Date().getFullYear());</script> GD PLAYER TV. All rights reserved.</p>
            <div class="marquee-container">
                <div class="logo-box">
                    <i class="fas fa-warning"></i>
                </div>
                <marquee behavior="scroll" direction="left" scrollamount="5">
                    This site is not affiliated with any television channel. All content is copyright of their respective owners. We cannot accept any responsibility for the content on this site. We cannot control or influence any audiovisual content on this site. Viewers are expected to be wise in processing the information obtained.
                </marquee>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let allChannels = [];
        let scheduleData = null;
        let currentCategory = null;
        let expandedRows = new Set();

        // Animate the logo
        function animateLogo() {
            let gdpElement = document.getElementById('gdp');
            if (!gdpElement) return;

            let chars = [...gdpElement.textContent];
            gdpElement.innerHTML = chars.map(c => `<span>${c}</span>`).join('');

            let spans = document.querySelectorAll('#gdp span');
            let i = 0;
            setInterval(() => {
                spans.forEach((s, idx) => s.style.color = idx === i ? 'white' : '#039be5');
                i = (i + 1) % spans.length;
            }, 100);
        }

        // Fetch schedule data from real API
        async function fetchSchedule() {
            // Using the same URL as in the original script
            const url = 'https://wasitv-pro.site/daddycors.php';
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data;
            } catch (err) {
                console.error('Error fetching schedule:', err);
                throw err;
            }
        }

        // Extract all channels from the JSON data
        function extractChannelsFromData(data) {
            const channels = [];
            const today = Object.keys(data)[0];
            const categories = Object.keys(data[today]);
            
            categories.forEach(category => {
                const events = data[today][category];
                
                events.forEach(event => {
                    // Handle channels array
                    if (event.channels && event.channels.length > 0) {
                        event.channels.forEach(channel => {
                            channels.push({
                                name: channel.channel_name,
                                category: category,
                                url: `${channel.channel_id}`,
                                eventName: event.event,
                                eventTime: event.time,
                                channelId: channel.channel_id
                            });
                        });
                    }
                    
                    // Handle channels2 array if exists
                    if (event.channels2 && event.channels2.length > 0) {
                        event.channels2.forEach(channel => {
                            channels.push({
                                name: channel.channel_name,
                                category: category,
                                url: `${channel.channel_id}`,
                                eventName: event.event,
                                eventTime: event.time,
                                channelId: channel.channel_id
                            });
                        });
                    }
                });
            });
            
            return channels;
        }

        // Group channels by event to handle multiple streams
        function groupChannelsByEvent(channels) {
            const eventsMap = new Map();
            
            channels.forEach(channel => {
                const eventKey = `${channel.eventName || 'Unknown Event'}-${channel.eventTime || 'Unknown Time'}-${channel.category}`;
                
                if (!eventsMap.has(eventKey)) {
                    eventsMap.set(eventKey, {
                        eventName: channel.eventName,
                        eventTime: channel.eventTime,
                        category: channel.category,
                        channels: []
                    });
                }
                
                eventsMap.get(eventKey).channels.push({
                    name: channel.name,
                    url: channel.url,
                    channelId: channel.channelId
                });
            });
            
            return Array.from(eventsMap.values());
        }
        
        // Get event status based on time
        function getEventStatus(eventTime) {
            if (!eventTime) return 'Upcoming';
            
            if (eventTime.toLowerCase().includes('live')) {
                return 'LIVE';
            }
            
            const now = new Date();
            let eventDate = new Date();
            
            const timeMatch = eventTime.match(/(\d{1,2}):(\d{2})\s*(AM|PM|am|pm)?/);
            if (timeMatch) {
                let hours = parseInt(timeMatch[1]);
                const minutes = parseInt(timeMatch[2]);
                const period = timeMatch[3];
                
                // Convert to 24-hour format
                if (period && period.toLowerCase() === 'pm' && hours < 12) {
                    hours += 12;
                } else if (period && period.toLowerCase() === 'am' && hours === 12) {
                    hours = 0;
                }
                
                // Shift from UTC to local (Pakistan Standard Time UTC+5)
                let localHours = (hours + 5) % 24;
                
                if (hours + 5 >= 24) {
                    eventDate.setDate(eventDate.getDate() + 1);
                }
                
                eventDate.setHours(localHours, minutes, 0, 0);
                
                const timeDiff = eventDate - now;
                const hoursDiff = timeDiff / (1000 * 60 * 60);
                
                if (hoursDiff < -2) {
                    return 'Completed';
                } else if (hoursDiff < 0.5 && hoursDiff > -2) {
                    return 'LIVE';
                } else {
                    return 'Upcoming';
                }
            } else {
                return 'Upcoming';
            }
        }

        // Format time for display
        function formatEventTime(eventTime) {
            if (!eventTime) return 'Time not available';
            
            if (eventTime.includes('LIVE') || eventTime.includes('Completed')) {
                return eventTime;
            }
            
            const timeMatch = eventTime.match(/(\d{1,2}):(\d{2})\s*(AM|PM|am|pm)?/);
            if (timeMatch) {
                let hours = parseInt(timeMatch[1]);
                const minutes = parseInt(timeMatch[2]);
                let period = timeMatch[3] ? timeMatch[3].toUpperCase() : '';
                
                if (!period && hours >= 12) {
                    period = 'PM';
                    if (hours > 12) hours -= 12;
                } else if (!period && hours < 12) {
                    period = 'AM';
                    if (hours === 0) hours = 12;
                } else if (period && hours === 0) {
                    hours = 12;
                } else if (period && period.toUpperCase() === 'PM' && hours < 12) {
                    hours += 12;
                    if (hours > 12) hours -= 12;
                }
                
                return `${hours}:${minutes.toString().padStart(2, '0')} ${period}`;
            }
            
            return eventTime;
        }

        // Toggle row expansion
        function toggleRowExpansion(rowId) {
            const row = document.getElementById(rowId);
            const icon = row.querySelector('.expand-icon');
            
            if (expandedRows.has(rowId)) {
                // Collapse
                expandedRows.delete(rowId);
                icon.textContent = '+';
                icon.classList.remove('expanded');
                icon.classList.add('collapsed');
                
                // Hide child rows
                let nextRow = row.nextElementSibling;
                while (nextRow && nextRow.classList.contains('channel-row')) {
                    nextRow.style.display = 'none';
                    nextRow = nextRow.nextElementSibling;
                }
            } else {
                // Expand
                expandedRows.add(rowId);
                icon.textContent = '-';
                icon.classList.remove('collapsed');
                icon.classList.add('expanded');
                
                // Show child rows
                let nextRow = row.nextElementSibling;
                while (nextRow && nextRow.classList.contains('channel-row')) {
                    nextRow.style.display = '';
                    nextRow = nextRow.nextElementSibling;
                }
            }
        }

        // Toggle category expansion
        function toggleCategoryExpansion(category) {
            const categoryId = `cat-${category}`;
            const categoryRows = document.querySelectorAll(`.event-row, .channel-row`);
            
            if (expandedRows.has(categoryId)) {
                // Collapse category
                expandedRows.delete(categoryId);
                document.querySelector(`.expand-icon[onclick="toggleCategoryExpansion('${category}')"]`).textContent = '+';
                
                // Hide all rows in this category
                let inCategory = false;
                categoryRows.forEach(row => {
                    if (row.previousElementSibling?.classList.contains('category-row') && 
                        row.previousElementSibling.textContent.includes(category)) {
                        inCategory = true;
                    }
                    
                    if (inCategory) {
                        row.style.display = 'none';
                    }
                    
                    if (row.classList.contains('category-row') && 
                        !row.textContent.includes(category)) {
                        inCategory = false;
                    }
                });
            } else {
                // Expand category
                expandedRows.add(categoryId);
                document.querySelector(`.expand-icon[onclick="toggleCategoryExpansion('${category}')"]`).textContent = '-';
                
                // Show all rows in this category
                let inCategory = false;
                categoryRows.forEach(row => {
                    if (row.previousElementSibling?.classList.contains('category-row') && 
                        row.previousElementSibling.textContent.includes(category)) {
                        inCategory = true;
                    }
                    
                    if (inCategory) {
                        row.style.display = '';
                    }
                    
                    if (row.classList.contains('category-row') && 
                        !row.textContent.includes(category)) {
                        inCategory = false;
                    }
                });
            }
        }

        // Render the JSON tree table
        function renderJsonTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            const keyword = document.getElementById('search').value.toLowerCase().trim();
            
            // Filter and group channels
            let filteredChannels = allChannels.filter(channel => 
                (channel.name.toLowerCase().includes(keyword) || 
                 channel.category.toLowerCase().includes(keyword) ||
                 (channel.eventName && channel.eventName.toLowerCase().includes(keyword)))
            );
            
            // Group channels by event
            const groupedEvents = groupChannelsByEvent(filteredChannels);
            
            if (groupedEvents.length === 0) {
                document.getElementById('noResults').classList.remove('d-none');
                document.getElementById('channelTable').style.display = 'none';
            } else {
                document.getElementById('noResults').classList.add('d-none');
                document.getElementById('channelTable').style.display = 'table';
            }
            
            // Group by category
            const categories = {};
            groupedEvents.forEach(event => {
                if (!categories[event.category]) {
                    categories[event.category] = [];
                }
                categories[event.category].push(event);
            });
            
            let rowId = 0;
            
            // Create rows for each category and event
            Object.keys(categories).forEach(category => {
                // Category row
                const categoryRow = document.createElement('tr');
                categoryRow.className = 'category-row';
                categoryRow.innerHTML = `
                    <td colspan="5">
                        <span class="expand-icon ${expandedRows.has(`cat-${category}`) ? 'expanded' : 'collapsed'}" 
                              onclick="toggleCategoryExpansion('${category}')">
                            ${expandedRows.has(`cat-${category}`) ? '-' : '+'}
                        </span>
                        <strong>${category}</strong>
                    </td>
                `;
                tableBody.appendChild(categoryRow);
                
                // Event rows for this category
                categories[category].forEach(event => {
                    const eventStatus = getEventStatus(event.eventTime);
                    const formattedTime = formatEventTime(event.eventTime);
                    const statusClass = `status-${eventStatus.toLowerCase()}`;
                    
                    const eventId = `event-${rowId++}`;
                    const eventRow = document.createElement('tr');
                    eventRow.id = eventId;
                    eventRow.className = 'event-row';
                    eventRow.innerHTML = `
                        <td></td>
                        <td>
                            <span class="expand-icon ${expandedRows.has(eventId) ? 'expanded' : 'collapsed'}" 
                                  onclick="toggleRowExpansion('${eventId}')">
                                ${expandedRows.has(eventId) ? '-' : '+'}
                            </span>
                            ${event.eventName || 'Unknown Event'}
                        </td>
                        <td>${formattedTime}</td>
                        <td><span class="${statusClass}">${eventStatus}</span></td>
                        <td>${event.channels.length} stream${event.channels.length !== 1 ? 's' : ''}</td>
                    `;
                    tableBody.appendChild(eventRow);
                    
                    // Channel rows for this event
                    event.channels.forEach(channel => {
                        const channelRow = document.createElement('tr');
                        channelRow.className = 'channel-row';
                        channelRow.style.display = expandedRows.has(eventId) ? '' : 'none';
                        channelRow.innerHTML = `
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td>
                                <a href="#" data-url="${channel.url}" data-name="${channel.name}" 
                                   class="stream-btn open-channel">
                                    <i class="fas fa-play-circle"></i> ${channel.name}
                                </a>
                            </td>
                        `;
                        tableBody.appendChild(channelRow);
                    });
                });
            });
            
            // Add event listeners to channel buttons
            document.querySelectorAll('.open-channel').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    openChannelViewer(this.dataset.url, this.dataset.name);
                });
            });
            
            updateResultCount(groupedEvents.length);
        }

        // Update result count
        function updateResultCount(count) {
            const resultElement = document.getElementById('resultCount');
            resultElement.textContent = count === 1 ? 
                `Showing ${count} event` : 
                `Showing ${count} events`;
        }

        // Open viewer
        function openChannelViewer(id, name) {
            // In a real implementation, this would open the player
            // For now, we'll show an alert with the stream info
            alert(`Opening stream: ${name}\nStream ID: ${id}`);
        }

        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            animateLogo();

            fetchSchedule()
                .then(data => {
                    scheduleData = data;
                    allChannels = extractChannelsFromData(data);
                    renderJsonTable();
                    document.getElementById('loadingSpinner').classList.add('d-none');
                })
                .catch(err => {
                    console.error('Failed to load schedule data:', err);
                    document.getElementById('loadingSpinner').classList.add('d-none');
                    document.getElementById('errorMessage').classList.remove('d-none');
                    document.getElementById('errorDetails').textContent = err.message || 'Failed to load channels from the API.';
                });
            
            // Add event listener for search input
            document.getElementById('search').addEventListener('input', renderJsonTable);
        });
    </script>
</body>
</html>